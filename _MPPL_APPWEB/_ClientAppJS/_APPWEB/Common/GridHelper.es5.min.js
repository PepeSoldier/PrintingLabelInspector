"use strict";function _defineProperty(n,t,i){return t in n?Object.defineProperty(n,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[t]=i,n}function GridHelper(n){var u=arguments.length<=1||arguments[1]===undefined?"":arguments[1],f=arguments.length<=2||arguments[2]===undefined?"":arguments[2];this.onItemDeletingBehavior=function(n,t){n.item.deleteConfirmed||(n.cancel=!0,bootbox.confirm({message:"Jesteś pewny, że chcesz to usunąć?",size:"small",buttons:{cancel:{label:'<i class="fa fa-times"><\/i> NIE'},confirm:{label:'<i class="fa fa-check"><\/i> TAK'}},callback:function(i){i==!0&&(n.item.deleteConfirmed=!0,$(t).jsGrid("deleteItem",n.item))}}))};var t=this,i=u+"/"+n,r=null;this.DB=function(){return{loadData:function(n){return t.GetList(!0,n)},insertItem:function(n){return t.Update(n)},updateItem:function(n){return t.Update(n)},deleteItem:function(n){return t.Delete(n)},updateManyItems:function(n,i){return t.UpdateMany(n,i)}}};this.SetFilter=function(){var n=arguments.length<=0||arguments[0]===undefined?{}:arguments[0],t=arguments.length<=1||arguments[1]===undefined?"":arguments[1];this.filterPlus=n;this.filterExtendName=_defineProperty({},t,this.filterPlus)};this.GetFilter=function(){return r};this.GetList=function(n,t){$.extend(t,this.filterExtendName);var u=t;return console.log("GridHelper.GetList"),this.filterPlus!==null&&this.filterPlus!=undefined&&(u=Object.assign(t,this.filterPlus)),r=u,$.ajax({"async":n,type:"POST",data:u,url:i+"GetList",success:function(){},error:function(){}})};this.Update=function(n){return console.log("GridHelper.Update"),$.ajax({"async":!0,type:"POST",data:n,url:i+"Update",success:function(n){n.Error==!0?(new Alert).Show("danger","Zapis nie udał się",!0):(new Alert).Show("success","Zapis zakończony",!0)},error:function(n,t,i){(new Alert).Show("danger","Zapis nie powiódł się. "+i,!0)}})};this.Delete=function(n){return $.ajax({"async":!0,type:"POST",data:n,url:i+"Delete",success:function(){(new Alert).Show("success","Usunięto",!0)},error:function(n,t,i){(new Alert).Show("danger","Usuwanie nie powiodło się. "+i,!0)}})};this.UpdateMany=function(n,t){return console.log("GridHelper.UpdateMany"),$.ajax({"async":!0,type:"POST",data:{item:n,ids:t},url:i+"GroupUpdate",success:function(n){n==!1?(new Alert).Show("danger","Zapis nie udał się",!0):(new Alert).Show("success","Zapis zakończony",!0)},error:function(n,t,i){(new Alert).Show("danger","Zapis nie powiódł się. "+i,!0)}})};this.ColumColor=function(n){var t=arguments.length<=1||arguments[1]===undefined?"Color":arguments[1],i=arguments.length<=2||arguments[2]===undefined?"KOLOR":arguments[2];return{name:t,title:i,type:"text",inserting:!1,filtering:!1,width:n>0?n:80,editTemplate:ColumnColorEditItemTemplate(),itemTemplate:ColumnColorItemTemplate(),editValue:ColumnColorValue()}};this.ColumColorEmpty=function(){return{name:"Color2",title:"KOLOR",type:"text",inserting:!1,width:"80",filtering:!1,editTemplate:ColumnColorEditItemTemplate(),itemTemplate:ColumnColorItemTemplate(),editValue:ColumnColorValue()}};ColumnColorValue=function(){return function(){return this!=undefined&&this._editPicker!=undefined?this._editPicker.css("background-color"):""}};ColumnColorItemTemplate=function(){return function(n,t){return'<div class="colorSelector"><div id="Color_'+t.Id+'" style="background-color: '+n+';"><\/div><\/div>'}};ColumnColorEditItemTemplate=function(){return function(n){return $el=$('<div class="colorColumn">'),$cs=$('<div class="colorSelector">'),$colorPresenter=$('<div class="colorPresenter" style="background-color: '+n+'">'),$picker=$('<div class="fas fa-paint-brush" style="float: left; min-width:24px; min-height:24px; padding: 2px 5px 0 5px;"><\/div>'),$random=$('<div class="fab fa-pinterest" style="float: left; min-width:24px; min-height:24px; padding: 2px 5px 0 5px;"><\/div>'),$el.append($cs),$el.append($picker),$el.append($random),$cs.append($colorPresenter),this._editPicker=$colorPresenter,$random.click(function(){var n=$(this).closest(".colorColumn");$(n).find(".colorPresenter").css("background-color","rgb("+Math.floor(Math.random()*255)+","+Math.floor(Math.random()*255)+","+Math.floor(Math.random()*255)+")")}),(new MyColorPicker2).Init($picker,$colorPresenter),$el}}}function JSONToCSVConvertor(n,t,i,r){var a=typeof n!="object"?JSON.parse(n):n,o="",f="",s,h,u,c,l,e,v;if(i){for(f="",index=0;index<r.length;index++)f+=r[index].title+";";f=f.slice(0,-1);o+=f+"\r\n"}for(s=0;s<a.length;s++){for(f="",h="",u="",index=0;index<r.length;index++)h=r[index].name,h!=null?(u=a[s][h],u=u==null||u=="undefined"||u=="null"?"":u,u!=""&&r[index].type=="date"&&(u=moment(u).format("YYYY-MM-DD HH:mm"))):u="",f+='"'+u+'";';f.slice(0,f.length-1);o+=f+"\r\n"}if(o==""){alert("Invalid data");return}c="GridDownload_"+t.replace(/ /g,"_");l=new Blob([o],{type:"text/csv;charset=utf-8;"});navigator.msSaveBlob?navigator.msSaveBlob(l,c):(e=document.createElement("a"),e.download!==undefined&&(v=URL.createObjectURL(l),e.setAttribute("href",v),e.style="visibility:hidden",e.download=c+".csv",document.body.appendChild(e),e.click(),document.body.removeChild(e)))}jsGrid.Grid.prototype.ids=[1,2,3];$.extend(jsGrid.ControlField.prototype,{_createExportButton:function(){return this._createGridButton("jsgrid-export-button","export data",function(n){n.ExportExcel()})},filterTemplate:function(){var n=this._createSearchButton();return n=this.clearFilterButton?n.add(this._createClearFilterButton()):n,this._grid.exporting?n.add(this._createExportButton()):n}});$.extend(jsGrid.Grid.prototype,{title:"",exporting:!1,selectedRowIndex:0,selectedCellIndex:0,onItemInserted:function(){$(this._insertRow[0]).find(".jsgrid-insert-button").css("display","unset")},onItemInserting:function(){$(this._insertRow[0]).find(".jsgrid-insert-button").css("display","none")},confirmDeleting:!1,bulkUpdate:!1,onItemUpdating:function(n){n.grid.bulkUpdate==!0?(console.log("bulkUpdate"),n.cancel=!0,n.grid._controller.updateManyItems(n.item,n.grid.ids)):console.log("normal")},_updateRow:function(n,t){var r=n.data("JSGridItem"),u=this._itemIndex(r),i=$.extend(!0,{},r,t),f=this._callEventHandler(this.onItemUpdating,{row:n,item:i,itemIndex:u,previousItem:r});return this._controllerCall("updateItem",i,f.cancel,function(f){var o=$.extend(!0,{},r),e;i=f.Error==!0?f.Item:$.extend(!0,r,t);e=this._finishUpdate(n,i,u);this._callEventHandler(this.onItemUpdated,{row:e,item:i,itemIndex:u,previousItem:o})})},bulkUpdateItemFunction:function(n,t){console.log("buItem - ids");console.log(t)},onItemDeleting:function(n){n.item.deleteConfirmed||(n.cancel=!0,bootbox.confirm({message:"Jesteś pewny, że chcesz to usunąć?",size:"small",buttons:{cancel:{label:'<i class="fa fa-times"><\/i> NIE'},confirm:{label:'<i class="fa fa-check"><\/i> TAK'}},callback:function(t){t==!0&&(n.item.deleteConfirmed=!0,n.grid._controller.deleteItem(n.item),$(n.row).remove())}}))},rowClick:function(n){var t=n.event.target,i=$(t).closest("tr");this.SelectCell(i[0].rowIndex,t.cellIndex)},finishDelete:function(n,t){var i=this._grid;i.option("data").splice(t,1)},rowDoubleClick:function(n){var t=n.event.target,i=$(t).closest("tr");this.SelectCell(i[0].rowIndex,t.cellIndex);this.editItem(this.data[this.selectedRowIndex]);this.FocusOnInput()},ChangeCell:function(n,t){this._editingRow==null&&this.SelectCell(this.selectedRowIndex+t,this.selectedCellIndex+n)},SelectCell:function(n,t){this.selectedRowIndex=this.selectedRowIndex==null||this.selectedRowIndex>this.data.length?0:this.selectedRowIndex;$(this._bodyGrid[0]).find(".jsgrid-cell").removeClass("selectedCell");var i=this.paging==!0?this.pageSize:this.data.length;this.selectedRowIndex=n>=0?n<i?n:i-1:0;this.selectedCellIndex=t>=0?t:0;$(this._bodyGrid[0].rows[this.selectedRowIndex].cells[this.selectedCellIndex]).addClass("selectedCell")},FocusOnInput:function(){var n=$(this._bodyGrid[0].rows[this.selectedRowIndex].cells[this.selectedCellIndex]).find("input, select");$(n).focus();$(n).select()},FocusOnFilter:function(){var i=this.option("filtering"),t,n;i==!1&&(this.option("inserting",!1),this.option("filtering",!0));t=$(this._headerGrid[0]).find(".jsgrid-filter-row");t.length>0&&(n=$(t[0].cells[this.selectedCellIndex]).find("input, select"),n.length>0||(n=$(t[0]).find("input, select")),n.length>0&&($(n[0]).focus(),$(n[0]).select()))},FocusOnInsert:function(){var t=this.option("inserting"),n;t==!1&&(this.option("inserting",!0),this.option("filtering",!1));n=$(this._headerGrid[0]).find(".jsgrid-insert-row");n.length>0&&(input=$(n[0]).find("input, select"),input.length>0&&($(input[0]).focus(),$(input[0]).select()))},ExportExcel:function(){var t;console.log("ExportExcel");var i=this.title!=null?this.title:"",r=this.fields,n=this.getFilter();n=n||(this.filtering?this.getFilter():{});$.extend(n,this._loadStrategy.loadParams(),this._sortingParams());n.pageSize=1e5;t=this._callEventHandler(this.onDataLoading,{filter:n});this._controllerCall("loadData",n,t.cancel,function(n){var t=this.paging?n.data:n;JSONToCSVConvertor(t,i,!0,r)})}});var MyDateField=function(n){jsGrid.Field.call(this,n)};MyDateField.prototype=new jsGrid.Field({itemTemplate:function(n){return moment(n).format("YYYY-MM-DD HH:mm")},insertTemplate:function(){return this._insertPicker=this.inserting?$("<input class='datetimepicker'>"):null},filterTemplate:function(){return this._filterPicker=this.filtering?$("<input class='datetimepicker'>"):null},editTemplate:function(n){return this._editPicker=this.editing?$("<input class='datetimepicker'>").val(moment(n).format("YYYY-MM-DD HH:mm")):$("<div class=''>").text(moment(n).format("YYYY-MM-DD HH:mm"))},insertValue:function(){return this._insertPicker.val()},filterValue:function(){return this._filterPicker.val()},editValue:function(){return this._editPicker.val()}});jsGrid.fields.date=MyDateField;