@{
    ViewBag.Title = "Test";
}

<div class="row">
    <div class="col-12" style="padding: 30px;">
        <div id="canvas1"></div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/p5.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        $("#sidebar-wrapper-left").hide();
    })

    var s = new Snake();
    var w = 600;
    var h = 600;

    function setup() {
        createCanvas(w, h);
        frameRate(5);
    }

    function draw() {
        background(51);
        s.TryEat();
        s.DrawFood();
        s.Update();
        s.Show();
    }

    function Snake() {
        this.x = 0; this.y = 0;
        this.w = 120; this.h = 120;
        this.xspeed = 0; this.yspeed = 0;
        this.tail = [];
        this.food = [];

        this.dir = function (x, y) {
            this.xspeed = x * this.w;
            this.yspeed = y * this.h;
        }
        this.Update = function () {
            this.AnimateTail();
            this.x += this.xspeed;
            this.y += this.yspeed;
            this.x = constrain(this.x, 0, w - this.w);
            this.y = constrain(this.y, 0, h - this.h);
        }
        this.Show = function () {
            fill(255);
            rect(this.x, this.y, this.w, this.h);
            for (let i = 0; i < this.tail.length; i++){
                fill(240);
                rect(this.tail[i][0], this.tail[i][1], this.w, this.h);
            }
        }
        this.DrawFood = function () {
            //console.log(this.food);
            if (this.food.length <= 0) {
                console.log("draw food");
                let cols = floor(w / this.w);
                let rows = floor(h / this.h);
                let rnd1 = floor(Math.random() * cols);
                let rnd2 = floor(Math.random() * rows);
                this.food = [rnd1 * this.w, rnd2 * this.h];
            }
            fill(255, 0, 0);
            rect(this.food[0], this.food[1], this.w, this.h);
        }
        this.TryEat = function () {

            if (this.food.length >= 2 && this.x == this.food[0] && this.y == this.food[1]) {
                console.log("eaten!");
                this.food = [];
                this.food.length = 0;
                this.Grow();
                this.AnimateTail();
            }
        }
        this.Grow = function () {
            this.tail.push([this.x, this.y]);
        }
        this.AnimateTail = function(){
            this.tail.splice(0, 0, [this.x, this.y]);
            this.tail.splice(-1, 1);
        }
    }

    function keyPressed() {
        if (keyCode === UP_ARROW)           { s.dir(0,-1); }
        else if (keyCode === DOWN_ARROW)    { s.dir(0, 1); }
        else if (keyCode === RIGHT_ARROW)   { s.dir(1, 0); }
        else if (keyCode === LEFT_ARROW)    { s.dir(-1,0); }
    }

</script>

